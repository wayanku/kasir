
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KASIR PINTAR PRO</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library Kamera & App -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; @apply bg-slate-50 text-slate-800; -webkit-tap-highlight-color: transparent; padding-bottom: 120px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* AREA KAMERA */
        #reader { 
            width: 100% !important; 
            height: 100% !important;
            min-height: 300px; 
            background: #1e1e2e;
            border: none !important;
        }
        #reader video { 
            object-fit: cover !important; 
            border-radius: 32px;
        }
        
        .scan-container {
            position: relative;
            border-radius: 28px;
            overflow: hidden;
            background: #000;
            border: 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        /* Garis Laser */
        .laser {
            position: absolute; width: 100%; height: 2px;
            background: #0d9488; /* teal-600 */
            box-shadow: 0 0 15px 2px #0d9488;
            top: 0; z-index: 10;
            animation: moveLaser 2s infinite ease-in-out;
            pointer-events: none;
        }
        @keyframes moveLaser {
            0% { top: 15%; }
            50% { top: 85%; }
            100% { top: 15%; }
        }

        .nav-btn.active { @apply text-teal-600 bg-teal-50; }
        .nav-btn.active svg { transform: translateY(-3px); }

        /* TOAST NOTIFICATION */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { background: rgba(0,0,0,0.85); color: white; padding: 12px 20px; rounded: 12px; border-radius: 50px; font-size: 14px; text-align: center; backdrop-filter: blur(4px); animation: fadeIn 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.2); pointer-events: auto; }

        /* PRINT STYLE */
        @media print {
            body, body * { visibility: hidden; }
            #receipt-area, #receipt-area * { visibility: visible; }
            #receipt-area { position: absolute; left: 0; top: 0; width: 100%; padding: 0; margin: 0; background: white; color: black; }
            .no-print { display: none !important; }
        }

        /* HIDE SCROLLBAR */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>

    <!-- HEADER -->
    <header class="px-6 py-4 bg-white/80 backdrop-blur-md sticky top-0 z-40 shadow-sm flex justify-between items-center border-b border-slate-100">
        <div>
            <h1 class="text-xl font-bold text-slate-800" id="header-nama-toko">Kasir<span class="text-teal-600">Pro</span></h1>
            <div class="flex items-center gap-2 mt-1">
                <div id="network-status" class="w-2 h-2 rounded-full bg-gray-300" title="Mengecek status jaringan..."></div>
                <p id="clock" class="text-[11px] font-semibold text-slate-400"></p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleSearch()" class="p-2.5 bg-slate-100 rounded-full text-slate-600 hover:bg-teal-50 hover:text-teal-600 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button onclick="bukaHalaman('pengaturan')" class="p-2.5 bg-slate-100 rounded-full text-slate-600 hover:bg-slate-200 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            </button>
        </div>
    </header>

    <!-- SEARCH OVERLAY -->
    <div id="search-box" class="fixed inset-0 bg-white z-[60] p-6 hidden">
        <div class="flex items-center gap-4 mb-6">
            <input type="text" id="in-search" placeholder="Cari nama atau kode..." class="w-full p-4 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-teal-500">
            <button onclick="toggleSearch()" class="text-sm font-bold text-red-500">Batal</button>
        </div>
        <div id="res-search" class="space-y-4"></div>
    </div>

    <main class="p-4 max-w-4xl mx-auto">
        
        <!-- HALAMAN DASHBOARD (NEW) -->
        <div id="p-dashboard" class="page active space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-teal-500 to-cyan-500 rounded-2xl p-5 text-white shadow-lg shadow-cyan-200">
                    <p class="text-sm font-medium opacity-80 mb-1">Omzet Hari Ini</p>
                    <h2 id="db-omzet-hari-ini" class="text-3xl font-bold">Rp 0</h2>
                </div>
                <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
                    <p class="text-sm font-medium text-slate-500 mb-1">Transaksi Hari Ini</p>
                    <h2 id="db-transaksi-hari-ini" class="text-3xl font-bold text-slate-800">0</h2>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
                <h3 class="font-bold text-slate-800 mb-3">Stok Segera Habis</h3>
                <div id="db-low-stock-list" class="space-y-3">
                    <p class="text-sm text-slate-400 text-center py-4">Semua stok aman.</p>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
                <h3 class="font-bold text-slate-800 mb-3">Produk Terlaris (Hari Ini)</h3>
                <div id="db-top-selling-list" class="space-y-3">
                    <p class="text-sm text-slate-400 text-center py-4">Belum ada produk yang terjual hari ini.</p>
                </div>
            </div>
        </div>

        <!-- HALAMAN KASIR -->
        <div id="p-kasir" class="page space-y-6">
            <!-- Scan Window -->
            <div class="scan-container shadow-xl shadow-slate-200">
                <div id="reader"></div>
                <div class="laser"></div>
                
                <!-- CONTROLS KAMERA (ZOOM & FLASH) -->
                <div id="cam-controls" class="absolute bottom-5 left-0 right-0 px-6 z-30 hidden flex flex-col gap-3">
                    <!-- Flash Button -->
                    <button id="btn-flash" onclick="toggleFlash()" class="self-end bg-black/50 backdrop-blur-md text-white p-3 rounded-full mb-2 hidden">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-width="2" stroke-linejoin="round"/></svg>
                    </button>
                    
                    <!-- Zoom Slider -->
                    <div id="zoom-box" class="bg-black/50 backdrop-blur-md p-2 rounded-full flex items-center gap-3 hidden w-full">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" stroke-width="2"/></svg>
                        <input type="range" id="zoom-slider" min="1" max="5" step="0.1" value="1" class="w-full h-1.5 bg-gray-200/50 rounded-lg appearance-none cursor-pointer range-sm">
                        <span id="zoom-value" class="text-white text-[10px] font-bold w-8">1x</span>
                    </div>
                </div>

                <!-- Tombol Jika Kamera Tidak Muncul -->
                <div id="camera-prompt" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900/90 text-white p-6 text-center z-20">
                    <svg class="w-12 h-12 mb-4 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke-width="2"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" stroke-width="2"/></svg>
                    <p class="mb-4 text-sm">Kamera memerlukan izin akses</p>
                    <button onclick="startKamera()" class="bg-teal-600 px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-teal-700 transition">Aktifkan Kamera</button>
                    <p class="mt-2 text-[10px] text-gray-400">Pastikan menggunakan HTTPS</p>
                </div>
            </div>

            <!-- Temp Scan List (Barang Scan Sementara) -->
            <div id="temp-scan-area" class="hidden bg-teal-50 rounded-xl p-4 border border-teal-100 shadow-inner">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-teal-900 text-sm">Hasil Scan</h3>
                    <button onclick="batalTempSemua()" class="text-[10px] text-red-500 font-bold bg-white px-2 py-1 rounded-lg border border-red-100">BATAL SEMUA</button>
                </div>
                <div id="temp-list" class="space-y-2 mb-3 max-h-[150px] overflow-y-auto"></div>
                <button onclick="masukKeranjang()" class="w-full bg-teal-600 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-teal-200 active:scale-95 transition">MASUKKAN KE KERANJANG</button>
            </div>

            <!-- Keranjang -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                <div class="flex justify-between mb-4">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2"><svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" stroke-width="2"/></svg> Keranjang</h2>
                    <button onclick="resetCart()" class="text-xs text-red-500">Kosongkan</button>
                </div>
                <div id="cart-list" class="space-y-3 max-h-[300px] overflow-y-auto mb-6 no-scrollbar">
                    <div class="text-center py-10 text-gray-300 text-sm">Belum ada item</div>
                </div>
                <div class="border-t border-slate-200 pt-4 space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-500 font-medium">Total Bayar</span>
                        <span id="total-harga" class="text-2xl font-bold text-teal-600">Rp 0</span>
                    </div>
                    <button onclick="bayarSekarang()" class="w-full bg-teal-600 hover:bg-teal-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-teal-200 active:scale-95 transition transform">BAYAR SEKARANG</button>
                </div>
            </div>
        </div>

        <!-- HALAMAN STOK -->
        <div id="p-stok" class="page space-y-6">
            <!-- Filter Kategori -->
            <div class="bg-white p-2 rounded-xl flex items-center gap-2 overflow-x-auto no-scrollbar">
                <select id="kategori-filter" onchange="renderStok()" class="bg-slate-100 text-slate-700 p-3 rounded-lg border-none outline-none font-bold text-sm appearance-none">
                    <!-- Options will be populated by JS -->
                </select>
            </div>

            <!-- List Stok Card Style -->
            <div id="list-stok" class="space-y-3 pb-10">
                <!-- Item akan dirender di sini sebagai kartu -->
            </div>

            <!-- FAB (Floating Action Button) -->
            <button id="fab-tambah-produk" onclick="openModalTambahProduk()" class="hidden fixed bottom-24 right-6 bg-teal-600 text-white w-16 h-16 rounded-2xl shadow-lg flex items-center justify-center z-50 hover:bg-teal-700 transition-transform transform active:scale-90">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
            </button>
        </div>
    </main>
    
    <!-- HALAMAN PELANGGAN (NEW) -->
    <div id="p-pelanggan" class="page p-4 max-w-4xl mx-auto space-y-6">
        <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
            <h3 class="font-bold text-slate-800 mb-4">Daftar Pelanggan</h3>
            <div id="list-pelanggan" class="space-y-3">
                <!-- List Pelanggan -->
            </div>
            <div id="empty-pelanggan" class="text-center py-10 text-gray-400 hidden">Belum ada data pelanggan</div>
        </div>

        <button onclick="openModalTambahPelanggan()" class="fixed bottom-24 right-6 bg-teal-600 text-white w-16 h-16 rounded-2xl shadow-lg flex items-center justify-center z-50 hover:bg-teal-700 transition-transform transform active:scale-90">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
        </button>
    </div>

    <!-- HALAMAN LAPORAN -->
    <div id="p-laporan" class="page p-4 max-w-4xl mx-auto space-y-6">
        <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
            <h3 class="font-bold text-slate-800 mb-4">Filter Laporan</h3>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                <div>
                    <label for="tgl-mulai" class="text-xs font-semibold text-slate-500">Tanggal Mulai</label>
                    <input type="date" id="tgl-mulai" class="w-full mt-1 p-2 bg-slate-100 rounded-lg border border-slate-200">
                </div>
                <div>
                    <label for="tgl-selesai" class="text-xs font-semibold text-slate-500">Tanggal Selesai</label>
                    <input type="date" id="tgl-selesai" class="w-full mt-1 p-2 bg-slate-100 rounded-lg border border-slate-200">
                </div>
                <button onclick="renderLaporan()" class="bg-teal-600 text-white rounded-lg py-2.5 font-bold h-fit">Terapkan</button>
            </div>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm"><p class="text-sm font-medium text-slate-500 mb-1">Total Omzet</p><h2 id="lpr-total-omzet" class="text-2xl font-bold text-teal-600">Rp 0</h2></div>
            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm"><p class="text-sm font-medium text-slate-500 mb-1">Total Transaksi</p><h2 id="lpr-total-transaksi" class="text-2xl font-bold text-slate-800">0</h2></div>
            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm"><p class="text-sm font-medium text-slate-500 mb-1">Produk Terjual</p><h2 id="lpr-produk-terjual" class="text-2xl font-bold text-slate-800">0</h2></div>
            <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm"><p class="text-sm font-medium text-slate-500 mb-1">Rata-rata/Trx</p><h2 id="lpr-avg-trx" class="text-2xl font-bold text-slate-800">Rp 0</h2></div>
        </div>

        <div class="bg-white rounded-2xl p-5 border border-slate-200 shadow-sm">
            <h3 class="font-bold text-slate-800 mb-4">Grafik Omzet Harian</h3>
            <div id="sales-chart-container" class="w-full h-64"></div>
        </div>

        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-gray-800">Riwayat Transaksi</h3>
                <button onclick="exportLaporanToCSV()" class="bg-emerald-50 text-emerald-600 px-4 py-2 rounded-xl text-sm font-bold hover:bg-emerald-100 transition">Export CSV</button>
            </div>
            <div id="list-riwayat" class="space-y-4 max-h-[400px] overflow-y-auto no-scrollbar">
                <!-- List Transaksi -->
            </div>
        </div>
    </div>

    <!-- HALAMAN PENGATURAN -->
    <div id="p-pengaturan" class="page p-4 max-w-4xl mx-auto space-y-6">
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 space-y-4">
            <h3 class="font-bold text-gray-800">Pengaturan</h3>

            <!-- Profil Toko -->
            <div class="p-4 bg-slate-50 rounded-xl space-y-3">
                <h4 class="font-bold text-sm text-gray-700">Profil Toko (Untuk Struk)</h4>
                <div>
                    <label class="text-xs text-gray-500">Nama Toko</label>
                    <input type="text" id="set-nama-toko" class="w-full p-2 rounded-lg border border-slate-200 text-sm font-bold" placeholder="Contoh: Toko Berkah">
                </div>
                <div>
                    <label class="text-xs text-gray-500">Alamat</label>
                    <input type="text" id="set-alamat-toko" class="w-full p-2 rounded-lg border border-slate-200 text-sm" placeholder="Alamat lengkap...">
                </div>
                <div>
                    <label class="text-xs text-gray-500">No. Telepon</label>
                    <input type="text" id="set-nohp-toko" class="w-full p-2 rounded-lg border border-slate-200 text-sm" placeholder="08...">
                </div>
                <div>
                    <label class="text-xs text-gray-500">Pesan Footer Struk</label>
                    <input type="text" id="set-footer-struk" class="w-full p-2 rounded-lg border border-slate-200 text-sm" placeholder="Terima Kasih...">
                </div>
                <button onclick="simpanProfilToko()" class="w-full bg-teal-600 text-white py-2 rounded-lg font-bold text-sm hover:bg-teal-700">Simpan Profil</button>
            </div>

            <div id="install-prompt-container" class="p-4 bg-blue-50 rounded-xl flex-col sm:flex-row flex justify-between items-center gap-3 hidden">
                <div>
                    <div class="font-bold text-sm text-blue-700">Install Aplikasi</div>
                    <div class="text-xs text-blue-400">Pasang aplikasi di layar utama untuk akses cepat dan offline.</div>
                </div>
                <button id="btn-install-app" onclick="promptInstall()" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-xl text-sm font-bold hover:bg-blue-200 w-full sm:w-auto">Install</button>
            </div>
            
            <div class="p-4 bg-slate-50 rounded-xl flex justify-between items-center">
                <div>
                    <div class="font-bold text-sm text-gray-700">Backup Data</div>
                    <div class="text-xs text-gray-400">Simpan database ke file JSON</div>
                </div>
                <button onclick="backupData()" class="bg-teal-50 text-teal-600 px-4 py-2 rounded-xl text-sm font-bold hover:bg-teal-100">Download</button>
            </div>

            <div class="p-4 bg-slate-50 rounded-xl flex justify-between items-center">
                <div>
                    <div class="font-bold text-sm text-gray-700">Pajak / PPN (%)</div>
                    <div class="text-xs text-gray-400">Otomatis ditambahkan ke total</div>
                </div>
                <input type="number" id="setting-pajak" onchange="simpanSettingPajak(this.value)" class="w-20 p-2 bg-white border border-slate-200 rounded-lg text-center font-bold outline-none focus:ring-2 focus:ring-teal-500" placeholder="0">
            </div>

            <div class="p-4 bg-slate-50 rounded-xl flex justify-between items-center">
                <div>
                    <div class="font-bold text-sm text-gray-700">Restore Data</div>
                    <div class="text-xs text-gray-400">Kembalikan data dari file</div>
                </div>
                <label class="bg-blue-50 text-blue-600 px-4 py-2 rounded-xl text-sm font-bold cursor-pointer hover:bg-blue-100">
                    Upload
                    <input type="file" id="file-restore" onchange="restoreData(this)" class="hidden" accept=".json">
                </label>
            </div>

            <div class="p-4 bg-red-50 rounded-xl flex justify-between items-center">
                <div>
                    <div class="font-bold text-sm text-red-700">Reset Aplikasi</div>
                    <div class="text-xs text-red-400">Hapus semua data permanen</div>
                </div>
                <button onclick="resetAplikasi()" class="bg-red-100 text-red-600 px-4 py-2 rounded-xl text-sm font-bold hover:bg-red-200">Reset</button>
            </div>
        </div>
        <div class="text-center text-xs text-gray-400">
            Versi 3.0.0 - KasirPintar Pro
        </div>
    </div>

    <!-- MODAL UNKNOWN PRODUCT -->
    <div id="modal-unknown" class="fixed inset-0 bg-black/60 z-[80] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm text-center shadow-2xl transform transition-all scale-100">
            <div class="w-16 h-16 bg-orange-100 text-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
            <h3 class="text-lg font-bold text-gray-800 mb-2">Produk Tidak Dikenal</h3>
            <p class="text-gray-500 text-sm mb-6">Barcode <span id="txt-unknown-sku" class="font-mono font-bold text-gray-800 bg-gray-100 px-2 py-1 rounded"></span> belum ada di stok.</p>
            <div class="flex gap-3">
                <button onclick="tutupModalUnknown()" class="flex-1 py-3 text-gray-500 font-bold hover:bg-gray-50 rounded-xl">Batal</button>
                <button onclick="redirectKeStok()" class="flex-1 py-3 bg-teal-600 text-white rounded-xl font-bold shadow-lg">Tambah Stok</button>
            </div>
        </div>
    </div>

    <!-- MODAL BAYAR (PROFESSIONAL) -->
    <div id="modal-bayar" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-end sm:items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl p-6 w-full max-w-md shadow-2xl animate-slideUp sm:animate-none">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-800">Pembayaran</h3>
                <button onclick="tutupModalBayar()" class="text-gray-400 hover:text-gray-800">✕</button>
            </div>
            
            <div class="mb-4">
                <label class="text-xs font-bold text-gray-500 ml-1 mb-1 block">PELANGGAN (Opsional)</label>
                <select id="pilih-pelanggan" class="w-full p-3 bg-slate-100 rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-teal-500">
                    <option value="">Umum (Non-Member)</option>
                </select>
            </div>

            <div class="bg-teal-50 p-6 rounded-2xl mb-4 text-center border border-teal-100">
                <p class="text-sm text-gray-500 font-bold uppercase tracking-wider">Total Tagihan</p>
                <h2 id="bayar-total" class="text-4xl font-bold text-teal-600 mt-2">Rp 0</h2>
            </div>

            <div class="mb-4">
                <label class="text-xs font-bold text-gray-500 ml-1 mb-1 block">DISKON TAMBAHAN (Rp)</label>
                <input type="number" id="input-diskon-global" onkeyup="hitungTotalBayar()" class="w-full p-3 bg-slate-100 rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-teal-500 transition-all" placeholder="0">
            </div>

            <div class="space-y-3 mb-6">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-500">Subtotal</span>
                    <span id="bayar-subtotal">Rp 0</span>
                </div>
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-500">Pajak</span>
                    <span id="bayar-pajak" class="text-emerald-500">Rp 0</span>
                </div>
            </div>

            <div class="space-y-4 mb-8">
                <div>
                    <label class="text-xs font-bold text-gray-500 ml-1 mb-1 block">UANG DITERIMA (F8)</label>
                    <input type="number" id="input-uang" onkeyup="hitungKembalian()" class="w-full p-4 bg-slate-100 rounded-xl text-xl font-bold outline-none focus:ring-2 focus:ring-teal-500 transition-all" placeholder="0">
                </div>
                <div class="flex justify-between items-center px-2 py-2 border-t border-dashed">
                    <span class="text-sm font-bold text-gray-500">Kembalian</span>
                    <span id="txt-kembalian" class="text-2xl font-bold text-emerald-600">Rp 0</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="tutupModalBayar()" class="py-4 text-gray-500 font-bold bg-slate-100 rounded-xl hover:bg-slate-200 transition">Batal</button>
                <button onclick="prosesPembayaranFinal()" class="py-4 bg-teal-600 text-white rounded-xl font-bold shadow-lg shadow-teal-200 hover:bg-teal-700 transition active:scale-95">Selesai (Enter)</button>
            </div>
        </div>
    </div>

    <!-- MODAL TAMBAH PRODUK -->
    <div id="modal-tambah-produk" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-end sm:items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl p-6 w-full max-w-md shadow-2xl animate-slideUp sm:animate-none">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-800">Tambah/Ubah Produk</h3>
                <button onclick="closeModalTambahProduk()" class="text-gray-400 hover:text-gray-800">✕</button>
            </div>
            
            <!-- Scanner Stok -->
            <div id="box-scanner-stok" class="hidden mb-4 rounded-2xl overflow-hidden bg-black relative border-4 border-white shadow-lg">
                <div id="reader-stok"></div>
                <button onclick="tutupScannerStok()" class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full font-bold z-10">✕</button>
            </div>

            <div class="space-y-3">
                <div class="flex gap-2">
                    <input type="text" id="f-sku" placeholder="SKU/Barcode" class="flex-1 p-4 bg-slate-100 rounded-xl outline-none text-sm font-medium focus:bg-white focus:ring-2 focus:ring-teal-500 transition border">
                    <button onclick="bukaScannerStok()" class="bg-teal-50 text-teal-600 px-4 rounded-xl hover:bg-teal-100 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 17h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" stroke-width="2"/></svg>
                    </button>
                </div>
                <input type="text" id="f-nama" placeholder="Nama Produk" class="w-full p-4 bg-slate-100 rounded-xl outline-none text-sm font-medium focus:bg-white focus:ring-2 focus:ring-teal-500 transition">
                <input type="text" id="f-kategori" list="kategori-list" placeholder="Kategori (opsional)" class="w-full p-4 bg-slate-100 rounded-xl outline-none text-sm font-medium focus:bg-white focus:ring-2 focus:ring-teal-500 transition">
                <datalist id="kategori-list"></datalist>
                <input type="number" id="f-harga" placeholder="Harga" class="w-full p-4 bg-slate-100 rounded-xl outline-none text-sm font-medium focus:bg-white focus:ring-2 focus:ring-teal-500 transition">
                <input type="number" id="f-stok" placeholder="Stok Awal" class="w-full p-4 bg-slate-100 rounded-xl outline-none text-sm font-medium focus:bg-white focus:ring-2 focus:ring-teal-500 transition">
                <button onclick="simpanProduk()" class="w-full mt-4 bg-teal-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-teal-200 active:scale-95 transition">Simpan Produk</button>
            </div>
        </div>
    </div>

    <!-- MODAL TAMBAH PELANGGAN -->
    <div id="modal-tambah-pelanggan" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-fadeIn">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-gray-800">Data Pelanggan</h3>
                <button onclick="closeModalTambahPelanggan()" class="text-gray-400 hover:text-gray-800">✕</button>
            </div>
            <div class="space-y-3">
                <input type="text" id="pel-nama" placeholder="Nama Pelanggan" class="w-full p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-teal-500">
                <input type="text" id="pel-nohp" placeholder="No. HP / WhatsApp" class="w-full p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-teal-500">
                <textarea id="pel-alamat" placeholder="Alamat (Opsional)" class="w-full p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-teal-500 h-20"></textarea>
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button onclick="closeModalTambahPelanggan()" class="py-3 text-gray-500 font-bold bg-slate-100 rounded-xl">Batal</button>
                    <button onclick="simpanPelanggan()" class="py-3 bg-teal-600 text-white rounded-xl font-bold shadow-lg">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL EDIT ITEM KERANJANG -->
    <div id="modal-edit-item" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-fadeIn">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-gray-800">Edit Item</h3>
                <button onclick="closeModalEditItem()" class="text-gray-400 hover:text-gray-800">✕</button>
            </div>
            <input type="hidden" id="edit-index">
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-500 block mb-1">Jumlah</label>
                    <input type="number" id="edit-qty" class="w-full p-3 bg-slate-100 rounded-xl font-bold outline-none focus:ring-2 focus:ring-teal-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 block mb-1">Diskon Item (Rp)</label>
                    <input type="number" id="edit-diskon" class="w-full p-3 bg-slate-100 rounded-xl font-bold outline-none focus:ring-2 focus:ring-teal-500" placeholder="0">
                </div>
                <button onclick="simpanEditItem()" class="w-full py-3 bg-teal-600 text-white rounded-xl font-bold shadow-lg hover:bg-teal-700 transition">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <!-- MODAL STRUK -->
    <div id="modal-struk" class="fixed inset-0 bg-black/60 z-[90] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl relative">
            <button onclick="tutupStruk()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-800 no-print">✕</button>
            
            <div id="receipt-area" class="text-center p-4 border-2 border-dashed border-gray-200 rounded-xl mb-4 bg-gray-50">
                <!-- Konten Struk -->
            </div>

            <div class="flex gap-3 no-print">
                <button onclick="window.print()" class="flex-1 py-3 bg-teal-600 text-white rounded-xl font-bold shadow-lg">Cetak</button>
                <button onclick="tutupStruk()" class="flex-1 py-3 text-gray-500 font-bold bg-gray-100 rounded-xl">Tutup</button>
            </div>
        </div>
    </div>

    <!-- NAVIGASI -->
    <nav class="fixed bottom-4 left-4 right-4 bg-white/95 backdrop-blur-xl border border-slate-200 shadow-xl shadow-slate-200/50 p-2 rounded-2xl flex justify-around items-center z-50">
        <button onclick="bukaHalaman('dashboard')" id="nav-dashboard" class="nav-btn active flex flex-col items-center gap-1 p-3 rounded-xl transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
            <span class="text-[10px] font-bold">HOME</span>
        </button>
        <button onclick="bukaHalaman('kasir')" id="nav-kasir" class="nav-btn text-gray-400 flex flex-col items-center gap-1 p-3 rounded-xl transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 17h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" stroke-width="2"/></svg>
            <span class="text-[10px] font-bold">KASIR</span>
        </button>
        <button onclick="bukaHalaman('stok')" id="nav-stok" class="nav-btn text-gray-400 flex flex-col items-center gap-1 p-3 rounded-xl transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" stroke-width="2"/></svg>
            <span class="text-[10px] font-bold">STOK</span>
        </button>
        <button onclick="bukaHalaman('pelanggan')" id="nav-pelanggan" class="nav-btn text-gray-400 flex flex-col items-center gap-1 p-3 rounded-xl transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
            <span class="text-[10px] font-bold">MEMBER</span>
        </button>
        <button onclick="bukaHalaman('laporan')" id="nav-laporan" class="nav-btn text-gray-400 flex flex-col items-center gap-1 p-3 rounded-xl transition-all duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span class="text-[10px] font-bold">LAPORAN</span>
        </button>
    </nav>

    <script src="app.js" defer></script>
</body>
</html>
