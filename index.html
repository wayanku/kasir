<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartPOS Elite | Premium POS System</title>
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');
        
        :root {
            --brand: #6366f1;
            --bg-dark: #0f172a;
            --surface: #1e293b;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg-dark); 
            color: white;
            overscroll-behavior: none;
        }

        .glass { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }

        .active-tab { 
            color: var(--brand); 
            background: rgba(99, 102, 241, 0.1);
            border-radius: 16px;
        }

        /* Scanner Frame Customization */
        #reader { border: none !important; }
        #reader__scan_region video { object-fit: cover !important; border-radius: 24px; }
        
        .scan-anim {
            position: absolute; width: 100%; height: 4px;
            background: linear-gradient(to right, transparent, var(--brand), transparent);
            box-shadow: 0 0 20px var(--brand);
            animation: scanMove 2s infinite ease-in-out;
            z-index: 20;
        }

        @keyframes scanMove {
            0%, 100% { top: 10%; opacity: 0.2; }
            50% { top: 90%; opacity: 1; }
        }

        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <!-- Top Status Bar -->
    <header class="p-6 flex justify-between items-center sticky top-0 z-50 bg-slate-950/50 backdrop-blur-md">
        <div>
            <h1 class="text-xl font-extrabold tracking-tighter text-indigo-400">ELITE<span class="text-white">POS</span></h1>
            <p id="date-now" class="text-[10px] text-slate-400 font-medium uppercase tracking-widest">Senin, 12 Januari 2024</p>
        </div>
        <div class="flex items-center gap-4">
            <div class="text-right hidden sm:block">
                <p class="text-xs text-slate-400 leading-none">Kasir Aktif</p>
                <p class="text-sm font-bold">Admin Store</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center border-2 border-indigo-300 shadow-lg shadow-indigo-500/20">
                <i data-lucide="user" class="w-5 h-5"></i>
            </div>
        </div>
    </header>

    <!-- Main Screens -->
    <main class="max-w-2xl mx-auto px-4 mt-2">
        
        <!-- DASHBOARD TAB -->
        <section id="tab-dashboard" class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-5 rounded-[2rem]">
                    <i data-lucide="trending-up" class="text-emerald-400 mb-2"></i>
                    <p class="text-xs text-slate-400">Omzet Hari Ini</p>
                    <h3 id="stat-revenue" class="text-xl font-bold">Rp 0</h3>
                </div>
                <div class="glass p-5 rounded-[2rem]">
                    <i data-lucide="shopping-bag" class="text-indigo-400 mb-2"></i>
                    <p class="text-xs text-slate-400">Total Transaksi</p>
                    <h3 id="stat-count" class="text-xl font-bold">0</h3>
                </div>
            </div>
            
            <div class="glass p-6 rounded-[2rem]">
                <h4 class="text-sm font-bold mb-4 flex items-center gap-2">
                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Grafik Penjualan 7 Hari
                </h4>
                <canvas id="salesChart" height="150"></canvas>
            </div>
        </section>

        <!-- POS / SCANNER TAB -->
        <section id="tab-pos" class="hidden space-y-6">
            <div class="relative rounded-[2.5rem] overflow-hidden border-4 border-slate-800 shadow-2xl aspect-square bg-slate-900">
                <div class="scan-anim"></div>
                <div id="reader"></div>
                <div class="absolute bottom-6 left-0 right-0 z-30 flex justify-center">
                    <div class="px-4 py-2 bg-black/50 backdrop-blur-md rounded-full text-[10px] font-bold tracking-widest border border-white/10 uppercase">
                        Kamera Aktif: Auto-Focus Ready
                    </div>
                </div>
            </div>

            <div class="flex gap-3">
                <div class="flex-1 glass rounded-2xl flex items-center px-4">
                    <i data-lucide="search" class="w-4 h-4 text-slate-500 mr-3"></i>
                    <input id="search-input" type="text" placeholder="Cari nama atau barcode..." class="bg-transparent border-none outline-none text-sm w-full py-4">
                </div>
                <button onclick="handleSearch()" class="px-6 bg-indigo-600 rounded-2xl font-bold shadow-lg shadow-indigo-600/30">CARI</button>
            </div>

            <div id="cart-list" class="space-y-3">
                <!-- Cart items load here -->
            </div>
        </section>

        <!-- INVENTORY TAB -->
        <section id="tab-inventory" class="hidden space-y-6">
            <div class="glass p-6 rounded-[2.5rem]">
                <h2 class="text-xl font-extrabold mb-6">Tambah Produk Baru</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input id="inv-barcode" type="text" placeholder="Barcode ID" class="col-span-2 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 outline-none focus:border-indigo-500">
                        <input id="inv-name" type="text" placeholder="Nama Barang" class="col-span-2 p-4 bg-slate-800/50 rounded-2xl border border-slate-700 outline-none focus:border-indigo-500">
                        <input id="inv-price" type="number" placeholder="Harga Jual" class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700 outline-none">
                        <input id="inv-stock" type="number" placeholder="Stok Awal" class="p-4 bg-slate-800/50 rounded-2xl border border-slate-700 outline-none">
                    </div>
                    <button onclick="saveProduct()" class="w-full py-4 bg-indigo-600 rounded-2xl font-black shadow-xl">SIMPAN KE DATABASE</button>
                </div>
            </div>
            
            <div id="master-list" class="space-y-3">
                <!-- Master products load here -->
            </div>
        </section>
    </main>

    <!-- Bottom Action & Navigation -->
    <div class="fixed bottom-0 left-0 right-0 z-[60] px-4 pb-6 pt-2 bg-gradient-to-t from-slate-950 to-transparent">
        
        <!-- Summary Floating Card (Only on POS Tab) -->
        <div id="checkout-card" class="mb-4 glass rounded-3xl p-5 flex justify-between items-center shadow-2xl border-indigo-500/30 hidden">
            <div>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Belanja</p>
                <h2 id="total-val" class="text-2xl font-black text-white">Rp 0</h2>
            </div>
            <button onclick="processPayment()" class="px-8 py-4 bg-indigo-600 rounded-2xl font-bold text-sm shadow-lg shadow-indigo-600/40 active:scale-95 transition-transform">
                BAYAR SEKARANG
            </button>
        </div>

        <!-- Tab Bar -->
        <nav class="glass rounded-[2rem] flex justify-around items-center p-2 border-white/5 shadow-2xl">
            <button onclick="switchTab('dashboard', this)" class="flex flex-col items-center p-3 active-tab transition-all">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold mt-1">Home</span>
            </button>
            <button onclick="switchTab('pos', this)" class="flex flex-col items-center p-3 transition-all text-slate-400">
                <i data-lucide="scan-barcode" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold mt-1">Kasir</span>
            </button>
            <button onclick="switchTab('inventory', this)" class="flex flex-col items-center p-3 transition-all text-slate-400">
                <i data-lucide="package" class="w-5 h-5"></i>
                <span class="text-[10px] font-bold mt-1">Stok</span>
            </button>
        </nav>
    </div>

    <!-- Payment Sound -->
    <audio id="beep-snd" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>

    <script>
        // --- DATA ENGINE ---
        let db = JSON.parse(localStorage.getItem('elite_pos_db')) || [];
        let cart = [];
        let logs = JSON.parse(localStorage.getItem('elite_pos_logs')) || [];
        
        let salesChart;
        const scanner = new Html5Qrcode("reader");

        // --- INIT APP ---
        window.onload = () => {
            lucide.createIcons();
            initChart();
            updateStats();
            document.getElementById('date-now').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        };

        function switchTab(tab, el) {
            // UI Update
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active-tab', 'text-indigo-400');
                btn.classList.add('text-slate-400');
            });
            el.classList.add('active-tab');
            el.classList.remove('text-slate-400');

            // Tab visibility
            ['dashboard', 'pos', 'inventory'].forEach(t => document.getElementById('tab-'+t).classList.add('hidden'));
            document.getElementById('tab-'+tab).classList.remove('hidden');
            
            // Scanner Control
            if(tab === 'pos') {
                startScanner();
                document.getElementById('checkout-card').classList.remove('hidden');
            } else {
                scanner.isScanning && scanner.stop();
                document.getElementById('checkout-card').classList.add('hidden');
            }

            if(tab === 'inventory') renderInventory();
            if(tab === 'dashboard') updateStats();
        }

        // --- SCANNER LOGIC ---
        function startScanner() {
            const config = { fps: 30, qrbox: { width: 250, height: 200 } };
            scanner.start({ facingMode: "environment" }, config, (text) => {
                addToCart(text);
                playSuccess();
                scanner.pause();
                setTimeout(() => scanner.resume(), 1500);
            }).catch(e => console.log("Scanner Error"));
        }

        // --- CORE FUNCTIONS ---
        function addToCart(barcode) {
            const product = db.find(p => p.id === barcode);
            if(!product) {
                Swal.fire({
                    title: 'Barang Tidak Ada',
                    text: `Barcode ${barcode} belum didaftarkan.`,
                    icon: 'warning',
                    confirmButtonText: 'Daftarkan Sekarang'
                }).then(r => { if(r.isConfirmed) switchTab('inventory', document.querySelectorAll('nav button')[2]); });
                return;
            }

            if(product.stock <= 0) return Swal.fire('Stok Habis!', product.name + ' tidak tersedia.', 'error');

            const item = cart.find(i => i.id === barcode);
            if(item) {
                if(item.qty < product.stock) item.qty++;
            } else {
                cart.push({ ...product, qty: 1 });
            }
            renderCart();
        }

        function renderCart() {
            const list = document.getElementById('cart-list');
            let total = 0;
            
            if(cart.length === 0) {
                list.innerHTML = `<div class="p-10 text-center text-slate-500 italic">Pindai barang di atas...</div>`;
                document.getElementById('total-val').innerText = 'Rp 0';
                return;
            }

            list.innerHTML = cart.map((item, idx) => {
                total += item.price * item.qty;
                return `
                <div class="glass p-4 rounded-3xl flex justify-between items-center animate-fade-in">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-indigo-500/20 flex items-center justify-center font-black text-indigo-400">${item.qty}x</div>
